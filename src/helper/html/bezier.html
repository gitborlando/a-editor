<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <canvas
      id="cvs"
      width="500"
      height="500"
      style="width: 500px; height: 500px; border: 1px solid black"
    ></canvas>
  </body>
  <script type="module">
    import { Bezier } from 'https://cdn.jsdelivr.net/npm/bezier-js@6.1.4/+esm'

    const ctx = cvs.getContext('2d')
    ctx.translate(100, 100)
    let [p0, p1, p2] = [
      [100, 0],
      [0, 0],
      [0, 100],
    ]
    const curve = new Bezier(...p0, ...p1, ...p2)
    var draw = function () {
      this.drawSkeleton(curve)
      this.drawCurve(curve)
      this.setColor('red')
      this.drawPoint(curve.get(0.5))
    }
    ctx.moveTo(...p1)
    ctx.quadraticCurveTo(...p0, ...p2)
    ctx.strokeStyle = 'red'
    ctx.stroke()
    const s = curve.split(0, 0.63)
    const e = curve.split(0.63, 1)
    console.log(s)
    console.log(e)
    l(p0, p1, p2)

    L([0, 0], [37, 0])
    L([46, 40], [14, 40])
    function L(p1, p2) {
      ctx.beginPath()
      ctx.moveTo(...p1)
      ctx.lineTo(...p2)
      ctx.stroke()
      ctx.fillStyle = 'blue'
      ctx.fillRect(...p2, 2, 2)
    }

    function d(p1, p2) {
      return Math.sqrt((p2[0] - p1[0]) ** 2 + (p2[1] - p1[1]) ** 2)
    }
    function l(p0, p1, p2) {
      let arr = []
      let last = [...p1]
      let iteration = 30
      let length = 0
      for (let i = 0; i <= iteration; i++) {
        let t = i / iteration
        let x = (1 - t) ** 2 * p1[0] + 2 * t * (1 - t) * p0[0] + t ** 2 * p2[0]
        let y = (1 - t) ** 2 * p1[1] + 2 * t * (1 - t) * p0[1] + t ** 2 * p2[1]
        const subLen = d([x, y], last)
        length += subLen
        arr.push([t, length, [x, y]])

        last = [x, y]
      }
      arr = arr.map(([t, subLen, p]) => [t, Math.sqrt((length / 2 - subLen) ** 2), p])
      arr.sort((a, b) => a[1] - b[1])
      //console.log(arr)
      const [x, y] = arr[0][2]
      ctx.beginPath()
      ctx.fillStyle = 'green'
      ctx.fillRect(x - 2, y - 2, 4, 4)
      ctx.fillText(`(${x},${y})`, x + 5, y + 5)

      console.log(`length: ${length}, shift: ${arr[0][1]}, t: ${arr[0][0]}`)
    }
  </script>
</html>
